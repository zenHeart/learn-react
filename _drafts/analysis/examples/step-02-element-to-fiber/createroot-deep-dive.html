<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReactDOM.createRoot Deep Dive - React 19 Internals</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .analysis-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .code-box {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .highlight {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #4caf50;
            margin: 10px 0;
        }
        
        .warning {
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
            margin: 10px 0;
        }
        
        .error {
            background: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #dc3545;
            margin: 10px 0;
        }
        
        .fiber-tree {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .step-box {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .demo-container {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .reference-link {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }
        
        .reference-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ReactDOM.createRoot Deep Dive - React 19 Internals</h1>
    
    <div class="analysis-section">
        <h2>ğŸ’¡ Learning Objectives</h2>
        <p>é€šè¿‡è¿™ä¸ªæ·±å…¥åˆ†æï¼Œä½ å°†ç†è§£ï¼š</p>
        <ul>
            <li><strong>ReactDOM.createRoot()</strong> è¿”å›çš„å¯¹è±¡ç»“æ„</li>
            <li><strong>_internalRoot (FiberRootNode)</strong> çš„ä½œç”¨å’Œç»“æ„</li>
            <li><strong>__reactContainer</strong> å’Œ <strong>__reactFiber</strong> çš„åŒºåˆ«</li>
            <li><strong>React 19</strong> ä¸­çš„æ–°ç‰¹æ€§å’Œå˜åŒ–</li>
            <li><strong>æºä»£ç ä½ç½®</strong> å’Œ <strong>è°ƒè¯•æŠ€å·§</strong></li>
        </ul>
    </div>

    <div class="analysis-section">
        <h2>ğŸš€ Interactive Demo</h2>
        
        <div class="demo-container">
            <button onclick="analyzeCreateRoot()">åˆ†æ createRoot å¯¹è±¡</button>
            <button onclick="analyzeInternalRoot()">åˆ†æ _internalRoot</button>
            <button onclick="analyzeContainerProperties()">åˆ†æå®¹å™¨å±æ€§</button>
            <button onclick="analyzeRootFiber()">åˆ†ææ ¹ Fiber èŠ‚ç‚¹</button>
            <button onclick="showFullStructure()">æ˜¾ç¤ºå®Œæ•´ç»“æ„</button>
        </div>
        
        <div id="demo-output"></div>
    </div>

    <div class="analysis-section">
        <h2>ğŸ“‹ Key Concepts Comparison</h2>
        
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>æ¦‚å¿µ</th>
                    <th>ç±»å‹</th>
                    <th>ä½ç½®</th>
                    <th>ä½œç”¨</th>
                    <th>è®¿é—®æ–¹å¼</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ReactDOMRoot</strong></td>
                    <td>Class Instance</td>
                    <td>createRoot() è¿”å›å€¼</td>
                    <td>å…¬å…± API æ¥å£</td>
                    <td>root.render(), root.unmount()</td>
                </tr>
                <tr>
                    <td><strong>_internalRoot</strong></td>
                    <td>FiberRootNode</td>
                    <td>ReactDOMRoot çš„ç§æœ‰å±æ€§</td>
                    <td>Fiber æ ‘çš„æ ¹å®¹å™¨</td>
                    <td>root._internalRoot (dev only)</td>
                </tr>
                <tr>
                    <td><strong>__reactContainer</strong></td>
                    <td>Property on DOM</td>
                    <td>DOM å…ƒç´ ä¸Šçš„å±æ€§</td>
                    <td>æŒ‡å‘ FiberRootNode</td>
                    <td>domElement.__reactContainer$[key]</td>
                </tr>
                <tr>
                    <td><strong>__reactFiber</strong></td>
                    <td>Property on DOM</td>
                    <td>DOM å…ƒç´ ä¸Šçš„å±æ€§</td>
                    <td>æŒ‡å‘å¯¹åº”çš„ Fiber èŠ‚ç‚¹</td>
                    <td>domElement.__reactFiber$[key]</td>
                </tr>
                <tr>
                    <td><strong>current</strong></td>
                    <td>HostRoot Fiber</td>
                    <td>FiberRootNode.current</td>
                    <td>å½“å‰ Fiber æ ‘çš„æ ¹èŠ‚ç‚¹</td>
                    <td>fiberRoot.current</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="analysis-section">
        <h2>ğŸ”— Source Code References</h2>
        
        <div class="step-box">
            <h3>React 19 æºä»£ç ä½ç½®</h3>
            <ul>
                <li><strong>ReactDOMRoot å®ç°:</strong> <a href="../../../packages/react-dom/src/client/ReactDOMRoot.js" class="reference-link">ReactDOMRoot.js</a></li>
                <li><strong>FiberRootNode åˆ›å»º:</strong> <a href="../../../packages/react-reconciler/src/ReactFiberRoot.js" class="reference-link">ReactFiberRoot.js</a></li>
                <li><strong>createRoot å‡½æ•°:</strong> <a href="../../../packages/react-dom/src/client/ReactDOMRoot.js#L200" class="reference-link">ReactDOMRoot.js#L200</a></li>
                <li><strong>createFiberRoot å‡½æ•°:</strong> <a href="../../../packages/react-reconciler/src/ReactFiberRoot.js#L200" class="reference-link">ReactFiberRoot.js#L200</a></li>
                <li><strong>HostRoot Fiber åˆ›å»º:</strong> <a href="../../../packages/react-reconciler/src/ReactFiber.js#L400" class="reference-link">ReactFiber.js#L400</a></li>
            </ul>
        </div>
    </div>

    <div class="analysis-section">
        <h2>ğŸ§ª Debugging Techniques</h2>
        
        <div class="step-box">
            <h3>åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•</h3>
            <pre class="code-box">// 1. åˆ›å»º root å¹¶è®¾ç½®æ–­ç‚¹
const root = ReactDOM.createRoot(document.getElementById('root'));
debugger; // åœ¨æ­¤å¤„è®¾ç½®æ–­ç‚¹

// 2. æ£€æŸ¥ root å¯¹è±¡ç»“æ„
console.log('Root object:', root);
console.log('Internal root:', root._internalRoot);

// 3. æ£€æŸ¥ DOM å…ƒç´ ä¸Šçš„å±æ€§
const container = document.getElementById('root');
console.log('Container keys:', Object.keys(container));

// 4. æ‰¾åˆ° React ç›¸å…³çš„å±æ€§
const reactKeys = Object.keys(container).filter(k => k.includes('react'));
console.log('React keys:', reactKeys);</pre>
        </div>
        
        <div class="step-box">
            <h3>ç”Ÿäº§ç¯å¢ƒ vs å¼€å‘ç¯å¢ƒ</h3>
            <div class="warning">
                <strong>æ³¨æ„ï¼š</strong> åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ_internalRoot ç­‰å†…éƒ¨å±æ€§å¯èƒ½ä¸å¯è®¿é—®æˆ–è¢«æ··æ·†ã€‚
                è°ƒè¯•æ—¶è¯·ä½¿ç”¨å¼€å‘ç‰ˆæœ¬çš„ Reactã€‚
            </div>
        </div>
    </div>

    <div class="analysis-section">
        <h2>ğŸ¯ Practice Exercise</h2>
        
        <div class="step-box">
            <h3>æŒ‘æˆ˜ä»»åŠ¡</h3>
            <ol>
                <li>åˆ›å»ºä¸€ä¸ª React æ ¹å®ä¾‹</li>
                <li>åˆ†æå…¶ _internalRoot ç»“æ„</li>
                <li>æ‰¾åˆ° DOM å…ƒç´ ä¸Šçš„ React å±æ€§</li>
                <li>ç†è§£å®ƒä»¬ä¹‹é—´çš„å…³ç³»</li>
            </ol>
            
            <button onclick="startExercise()">å¼€å§‹ç»ƒä¹ </button>
            <div id="exercise-output"></div>
        </div>
    </div>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel" data-type="module">
        import React from "https://esm.sh/react@19";
        import ReactDOM from "https://esm.sh/react-dom@19/client";

        // å®‰å…¨çš„JSONåºåˆ—åŒ–å‡½æ•°
        function safeStringify(obj, depth = 2) {
            const seen = new WeakSet();
            return JSON.stringify(obj, (key, value) => {
                if (depth <= 0) return '[Max Depth Reached]';
                if (typeof value === 'object' && value !== null) {
                    if (seen.has(value)) return '[Circular Reference]';
                    seen.add(value);
                }
                if (typeof value === 'function') return '[Function]';
                return value;
            }, 2);
        }

        // åˆ†æ createRoot å¯¹è±¡
        window.analyzeCreateRoot = function() {
            const output = document.getElementById('demo-output');
            
            // åˆ›å»ºä¸´æ—¶å®¹å™¨
            const tempContainer = document.createElement('div');
            document.body.appendChild(tempContainer);
            
            // åˆ›å»º root
            const root = ReactDOM.createRoot(tempContainer);
            
            const analysis = {
                constructor: root.constructor.name,
                methods: Object.getOwnPropertyNames(root).filter(prop => typeof root[prop] === 'function'),
                properties: Object.getOwnPropertyNames(root).filter(prop => typeof root[prop] !== 'function'),
                prototype: Object.getOwnPropertyNames(Object.getPrototypeOf(root))
            };
            
            output.innerHTML = `
                <div class="analysis-section">
                    <h3>ğŸ” ReactDOMRoot å¯¹è±¡åˆ†æ</h3>
                    <pre class="code-box">æ„é€ å‡½æ•°: ${analysis.constructor}

å…¬å…±æ–¹æ³•:
${analysis.methods.map(method => `  â€¢ ${method}()`).join('\n')}

å±æ€§:
${analysis.properties.map(prop => `  â€¢ ${prop}: ${typeof root[prop]}`).join('\n')}

åŸå‹æ–¹æ³•:
${analysis.prototype.map(method => `  â€¢ ${method}`).join('\n')}</pre>
                    
                    <div class="highlight">
                        <strong>å…³é”®å‘ç°:</strong>
                        <ul>
                            <li>ReactDOMRoot æ˜¯ä¸€ä¸ªç±»å®ä¾‹</li>
                            <li>ä¸»è¦æä¾› render() å’Œ unmount() æ–¹æ³•</li>
                            <li>å†…éƒ¨çŠ¶æ€é€šè¿‡ç§æœ‰å±æ€§ç®¡ç†</li>
                        </ul>
                    </div>
                </div>
            `;
            
            // æ¸…ç†
            document.body.removeChild(tempContainer);
        };

        // åˆ†æ _internalRoot
        window.analyzeInternalRoot = function() {
            const output = document.getElementById('demo-output');
            
            const tempContainer = document.createElement('div');
            document.body.appendChild(tempContainer);
            
            const root = ReactDOM.createRoot(tempContainer);
            const internalRoot = root._internalRoot;
            
            if (internalRoot) {
                output.innerHTML = `
                    <div class="analysis-section">
                        <h3>ğŸ—ï¸ _internalRoot (FiberRootNode) åˆ†æ</h3>
                        <pre class="code-box">ç±»å‹: ${internalRoot.constructor?.name || 'FiberRootNode'}

å…³é”®å±æ€§:
  â€¢ containerInfo: ${internalRoot.containerInfo === tempContainer ? 'DOMå®¹å™¨å¼•ç”¨' : 'æœªçŸ¥'}
  â€¢ current: ${internalRoot.current ? 'HostRoot FiberèŠ‚ç‚¹' : 'null'}
  â€¢ finishedWork: ${internalRoot.finishedWork || 'null'}
  â€¢ pendingLanes: ${internalRoot.pendingLanes || 0}
  â€¢ suspendedLanes: ${internalRoot.suspendedLanes || 0}
  â€¢ expiredLanes: ${internalRoot.expiredLanes || 0}
  â€¢ tag: ${internalRoot.tag}
  â€¢ callbackNode: ${internalRoot.callbackNode || 'null'}
  â€¢ callbackPriority: ${internalRoot.callbackPriority || 0}</pre>
                        
                        <div class="highlight">
                            <strong>FiberRootNode çš„ä½œç”¨:</strong>
                            <ul>
                                <li><strong>containerInfo:</strong> æŒ‡å‘çœŸå®çš„ DOM å®¹å™¨</li>
                                <li><strong>current:</strong> æŒ‡å‘å½“å‰çš„ Fiber æ ‘æ ¹èŠ‚ç‚¹</li>
                                <li><strong>finishedWork:</strong> æŒ‡å‘å®Œæˆçš„å·¥ä½œæ ‘</li>
                                <li><strong>pendingLanes:</strong> å¾…å¤„ç†çš„ä¼˜å…ˆçº§è½¦é“</li>
                                <li><strong>è°ƒåº¦ç›¸å…³:</strong> ç®¡ç†æ¸²æŸ“è°ƒåº¦å’Œä¼˜å…ˆçº§</li>
                            </ul>
                        </div>
                        
                        <div class="warning">
                            <strong>æºä»£ç ä½ç½®:</strong> 
                            <a href="../../../packages/react-reconciler/src/ReactFiberRoot.js" class="reference-link">ReactFiberRoot.js</a>
                        </div>
                    </div>
                `;
            } else {
                output.innerHTML = `
                    <div class="analysis-section">
                        <h3>ğŸ—ï¸ _internalRoot åˆ†æ</h3>
                        <div class="error">
                            <strong>æ— æ³•è®¿é—® _internalRoot:</strong> è¿™é€šå¸¸å‘ç”Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒReact ä¼šéšè—å†…éƒ¨å±æ€§ã€‚
                            è¯·ä½¿ç”¨å¼€å‘ç‰ˆæœ¬çš„ React è¿›è¡Œè°ƒè¯•ã€‚
                        </div>
                        
                        <pre class="code-box">ç†è®ºä¸Šï¼Œ_internalRoot (FiberRootNode) åŒ…å«:

â€¢ containerInfo: æŒ‡å‘ DOM å®¹å™¨å…ƒç´ 
â€¢ current: æŒ‡å‘ HostRoot Fiber èŠ‚ç‚¹
â€¢ finishedWork: å®Œæˆçš„å·¥ä½œæ ‘
â€¢ pendingLanes: å¾…å¤„ç†çš„ä¼˜å…ˆçº§è½¦é“
â€¢ suspendedLanes: æš‚åœçš„ä¼˜å…ˆçº§è½¦é“
â€¢ expiredLanes: è¿‡æœŸçš„ä¼˜å…ˆçº§è½¦é“
â€¢ callbackNode: è°ƒåº¦å›è°ƒèŠ‚ç‚¹
â€¢ callbackPriority: è°ƒåº¦ä¼˜å…ˆçº§</pre>
                    </div>
                `;
            }
            
            document.body.removeChild(tempContainer);
        };

        // åˆ†æå®¹å™¨å±æ€§
        window.analyzeContainerProperties = function() {
            const output = document.getElementById('demo-output');
            
            const tempContainer = document.createElement('div');
            tempContainer.id = 'temp-analysis-container';
            document.body.appendChild(tempContainer);
            
            const root = ReactDOM.createRoot(tempContainer);
            
            // æ¸²æŸ“ä¸€ä¸ªç®€å•çš„å…ƒç´ æ¥è§¦å‘ fiber åˆ›å»º
            const element = React.createElement('div', { id: 'test-element' }, 'Test Content');
            root.render(element);
            
            setTimeout(() => {
                // æŸ¥æ‰¾ React ç›¸å…³çš„å±æ€§
                const allKeys = Object.keys(tempContainer);
                const reactContainerKeys = allKeys.filter(k => k.includes('reactContainer'));
                const reactFiberKeys = allKeys.filter(k => k.includes('reactFiber'));
                
                output.innerHTML = `
                    <div class="analysis-section">
                        <h3>ğŸ  DOM å®¹å™¨å±æ€§åˆ†æ</h3>
                        <pre class="code-box">å®¹å™¨å…ƒç´ : ${tempContainer.tagName}#${tempContainer.id}

æ‰€æœ‰å±æ€§ (${allKeys.length}):
${allKeys.map(key => `  â€¢ ${key}: ${typeof tempContainer[key]}`).join('\n')}

React Container å±æ€§:
${reactContainerKeys.map(key => `  â€¢ ${key}: ${tempContainer[key] ? 'FiberRootNodeå¼•ç”¨' : 'null'}`).join('\n')}

React Fiber å±æ€§:
${reactFiberKeys.map(key => `  â€¢ ${key}: ${tempContainer[key] ? 'FiberèŠ‚ç‚¹å¼•ç”¨' : 'null'}`).join('\n')}</pre>
                        
                        <div class="highlight">
                            <strong>å±æ€§ä½œç”¨è¯´æ˜:</strong>
                            <ul>
                                <li><strong>__reactContainer$[randomKey]:</strong> æŒ‡å‘ FiberRootNode</li>
                                <li><strong>__reactFiber$[randomKey]:</strong> æŒ‡å‘å¯¹åº”çš„ Fiber èŠ‚ç‚¹</li>
                                <li><strong>éšæœºé”®å:</strong> é˜²æ­¢å¤–éƒ¨ç›´æ¥è®¿é—®å†…éƒ¨çŠ¶æ€</li>
                                <li><strong>åŒå‘å¼•ç”¨:</strong> DOM â†” Fiber èŠ‚ç‚¹ç›¸äº’å¼•ç”¨</li>
                            </ul>
                        </div>
                        
                        <pre class="fiber-tree">å…³ç³»å›¾:
DOMå®¹å™¨ â†â†’ __reactContainer$ â†â†’ FiberRootNode
DOMå®¹å™¨ â†â†’ __reactFiber$ â†â†’ HostRoot Fiber</pre>
                    </div>
                `;
                
                document.body.removeChild(tempContainer);
            }, 100);
        };

        // åˆ†ææ ¹ Fiber èŠ‚ç‚¹
        window.analyzeRootFiber = function() {
            const output = document.getElementById('demo-output');
            
            const tempContainer = document.createElement('div');
            tempContainer.id = 'temp-fiber-container';
            document.body.appendChild(tempContainer);
            
            const root = ReactDOM.createRoot(tempContainer);
            const element = React.createElement('div', { className: 'test-app' }, 'Fiber Analysis');
            root.render(element);
            
            setTimeout(() => {
                const fiberKey = Object.keys(tempContainer).find(k => k.includes('reactFiber'));
                const fiber = fiberKey ? tempContainer[fiberKey] : null;
                
                if (fiber) {
                    output.innerHTML = `
                        <div class="analysis-section">
                            <h3>ğŸŒ³ HostRoot Fiber èŠ‚ç‚¹åˆ†æ</h3>
                            <pre class="code-box">Fiber èŠ‚ç‚¹ç±»å‹: ${fiber.constructor?.name || 'Fiber'}

æ ¸å¿ƒå±æ€§:
  â€¢ tag: ${fiber.tag} (${fiber.tag === 3 ? 'HostRoot' : 'Unknown'})
  â€¢ type: ${fiber.type || 'null'}
  â€¢ stateNode: ${fiber.stateNode === tempContainer ? 'DOMå®¹å™¨å¼•ç”¨' : 'Other'}
  â€¢ mode: ${fiber.mode}
  â€¢ key: ${fiber.key || 'null'}
  â€¢ ref: ${fiber.ref || 'null'}

æ ‘ç»“æ„:
  â€¢ child: ${fiber.child ? 'First child fiber' : 'null'}
  â€¢ sibling: ${fiber.sibling ? 'Next sibling fiber' : 'null'}
  â€¢ return: ${fiber.return ? 'Parent fiber' : 'null'}

çŠ¶æ€ç®¡ç†:
  â€¢ memoizedState: ${fiber.memoizedState || 'null'}
  â€¢ memoizedProps: ${fiber.memoizedProps ? 'Props object' : 'null'}
  â€¢ pendingProps: ${fiber.pendingProps ? 'Pending props' : 'null'}

React 19 ç‰¹æ€§:
  â€¢ flags: ${fiber.flags || 0}
  â€¢ subtreeFlags: ${fiber.subtreeFlags || 0}
  â€¢ lanes: ${fiber.lanes || 0}
  â€¢ childLanes: ${fiber.childLanes || 0}</pre>
                            
                            <div class="highlight">
                                <strong>HostRoot Fiber ç‰¹ç‚¹:</strong>
                                <ul>
                                    <li><strong>tag: 3</strong> - æ ‡è¯†è¿™æ˜¯ä¸€ä¸ª HostRoot ç±»å‹çš„ Fiber</li>
                                    <li><strong>stateNode</strong> - æŒ‡å‘çœŸå®çš„ DOM å®¹å™¨</li>
                                    <li><strong>child</strong> - æŒ‡å‘åº”ç”¨çš„æ ¹ç»„ä»¶ Fiber</li>
                                    <li><strong>æ—  return</strong> - ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ²¡æœ‰çˆ¶èŠ‚ç‚¹</li>
                                </ul>
                            </div>
                        </div>
                    `;
                } else {
                    output.innerHTML = `
                        <div class="analysis-section">
                            <h3>ğŸŒ³ Fiber èŠ‚ç‚¹åˆ†æ</h3>
                            <div class="error">
                                æ— æ³•è®¿é—® Fiber èŠ‚ç‚¹ï¼Œå¯èƒ½æ˜¯ç”±äºï¼š
                                <ul>
                                    <li>React ç‰ˆæœ¬å·®å¼‚</li>
                                    <li>ç”Ÿäº§ç¯å¢ƒé™åˆ¶</li>
                                    <li>å±æ€§åç§°å˜åŒ–</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
                
                document.body.removeChild(tempContainer);
            }, 100);
        };

        // æ˜¾ç¤ºå®Œæ•´ç»“æ„
        window.showFullStructure = function() {
            const output = document.getElementById('demo-output');
            
            output.innerHTML = `
                <div class="analysis-section">
                    <h3>ğŸ”— React 19 å®Œæ•´ç»“æ„å…³ç³»å›¾</h3>
                    
                    <pre class="fiber-tree">ç”¨æˆ·è°ƒç”¨:
ReactDOM.createRoot(container) 
    â†“
è¿”å›: ReactDOMRoot å¯¹è±¡
    â”œâ”€ render() æ–¹æ³•
    â”œâ”€ unmount() æ–¹æ³•
    â””â”€ _internalRoot (FiberRootNode)
        â”œâ”€ containerInfo â†’ DOM å®¹å™¨
        â”œâ”€ current â†’ HostRoot Fiber
        â”œâ”€ pendingLanes â†’ å¾…å¤„ç†ä¼˜å…ˆçº§
        â”œâ”€ suspendedLanes â†’ æš‚åœä¼˜å…ˆçº§
        â””â”€ expiredLanes â†’ è¿‡æœŸä¼˜å…ˆçº§

DOM å®¹å™¨è·å¾—å±æ€§:
    â”œâ”€ __reactContainer$[key] â†’ FiberRootNode
    â””â”€ __reactFiber$[key] â†’ HostRoot Fiber

HostRoot Fiber ç»“æ„:
    â”œâ”€ tag: 3 (HostRoot)
    â”œâ”€ stateNode â†’ DOM å®¹å™¨
    â”œâ”€ child â†’ App Fiber
    â”œâ”€ flags â†’ å‰¯ä½œç”¨æ ‡è®°
    â”œâ”€ lanes â†’ ä¼˜å…ˆçº§è½¦é“
    â””â”€ mode â†’ æ¸²æŸ“æ¨¡å¼</pre>
                    
                    <div class="highlight">
                        <strong>å…³é”®ç†è§£ç‚¹:</strong>
                        <ul>
                            <li><strong>ReactDOMRoot:</strong> ç”¨æˆ·æ¥å£ï¼Œæä¾› render/unmount æ–¹æ³•</li>
                            <li><strong>FiberRootNode:</strong> å†…éƒ¨å®¹å™¨ï¼Œç®¡ç†æ•´ä¸ª Fiber æ ‘</li>
                            <li><strong>HostRoot Fiber:</strong> Fiber æ ‘çš„æ ¹èŠ‚ç‚¹</li>
                            <li><strong>DOM å±æ€§:</strong> å»ºç«‹ DOM å’Œ Fiber çš„åŒå‘å¼•ç”¨</li>
                            <li><strong>ä¼˜å…ˆçº§ç³»ç»Ÿ:</strong> React 19 çš„ lanes æœºåˆ¶</li>
                        </ul>
                    </div>
                    
                    <div class="step-box">
                        <h4>æºä»£ç è·Ÿè¸ªè·¯å¾„</h4>
                        <ol>
                            <li><a href="../../../packages/react-dom/src/client/ReactDOMRoot.js#L200" class="reference-link">createRoot()</a> åˆ›å»º ReactDOMRoot</li>
                            <li><a href="../../../packages/react-reconciler/src/ReactFiberRoot.js#L200" class="reference-link">createFiberRoot()</a> åˆ›å»º FiberRootNode</li>
                            <li><a href="../../../packages/react-reconciler/src/ReactFiber.js#L400" class="reference-link">createHostRootFiber()</a> åˆ›å»º HostRoot Fiber</li>
                            <li><a href="../../../packages/react-reconciler/src/ReactFiberWorkLoop.js#L100" class="reference-link">scheduleUpdateOnFiber()</a> è°ƒåº¦æ›´æ–°</li>
                        </ol>
                    </div>
                </div>
            `;
        };

        // å¼€å§‹ç»ƒä¹ 
        window.startExercise = function() {
            const output = document.getElementById('exercise-output');
            
            output.innerHTML = `
                <div class="step-box">
                    <h4>ğŸ¯ å®è·µç»ƒä¹ ï¼šåˆ†æä½ è‡ªå·±çš„ React åº”ç”¨</h4>
                    
                    <pre class="code-box">// 1. åœ¨ä½ çš„ React åº”ç”¨ä¸­æ·»åŠ è¿™æ®µä»£ç 
const container = document.getElementById('root');
const root = ReactDOM.createRoot(container);

// 2. åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹ä»£ç 
console.log('=== React Root åˆ†æ ===');
console.log('Root å¯¹è±¡:', root);
console.log('Internal Root:', root._internalRoot);
console.log('Container å±æ€§:', Object.keys(container));

// 3. æŸ¥æ‰¾ React ç›¸å…³å±æ€§
const reactKeys = Object.keys(container).filter(k => k.includes('react'));
console.log('React å±æ€§:', reactKeys);

// 4. åˆ†æ Fiber èŠ‚ç‚¹
const fiberKey = reactKeys.find(k => k.includes('Fiber'));
if (fiberKey) {
    const fiber = container[fiberKey];
    console.log('Root Fiber:', fiber);
    console.log('Fiber tag:', fiber.tag);
    console.log('Fiber child:', fiber.child);
}</pre>
                    
                    <div class="highlight">
                        <strong>ç»ƒä¹ ç›®æ ‡:</strong>
                        <ul>
                            <li>ç†è§£ createRoot è¿”å›çš„å¯¹è±¡ç»“æ„</li>
                            <li>æ‰¾åˆ° FiberRootNode å’Œ HostRoot Fiber</li>
                            <li>åˆ†æ DOM å…ƒç´ ä¸Šçš„ React å±æ€§</li>
                            <li>ç†è§£å„ä¸ªç»„ä»¶ä¹‹é—´çš„å…³ç³»</li>
                        </ul>
                    </div>
                    
                    <div class="warning">
                        <strong>æ³¨æ„äº‹é¡¹:</strong>
                        <ul>
                            <li>ä½¿ç”¨å¼€å‘ç‰ˆæœ¬çš„ React è¿›è¡Œè°ƒè¯•</li>
                            <li>ç”Ÿäº§ç¯å¢ƒä¸­å†…éƒ¨å±æ€§å¯èƒ½ä¸å¯è®¿é—®</li>
                            <li>ä¸è¦åœ¨ç”Ÿäº§ä»£ç ä¸­ä¾èµ–å†…éƒ¨ API</li>
                        </ul>
                    </div>
                </div>
            `;
        };
    </script>
</body>
</html> 